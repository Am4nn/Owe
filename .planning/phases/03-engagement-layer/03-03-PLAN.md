---
phase: 03-engagement-layer
plan: 03
type: execute
wave: 2
gap_closure: true
depends_on: ["01"]
files_modified:
  - app/(app)/groups/[id]/index.tsx
autonomous: true
requirements:
  - NOTF-03

must_haves:
  truths:
    - "User can enable/disable smart reminders and set delay_days per group"
  artifacts:
    - path: "app/(app)/groups/[id]/index.tsx"
      provides: "Smart Reminders UI section importing and using useReminderConfig"
  key_links:
    - from: "app/(app)/groups/[id]/index.tsx"
      to: "useReminderConfig"
      via: "toggle Switch calls upsertReminderConfig"
      pattern: "upsertReminderConfig"
---

<objective>
Close the gap identified in 03-VERIFICATION.md for NOTF-03. The backend for smart reminders is fully implemented, but `useReminderConfig` is orphaned. This plan adds the user-facing UI in the group detail screen to configure smart reminders per group.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-engagement-layer/03-VERIFICATION.md
</context>

<interfaces>
From src/features/notifications/hooks.ts:
```typescript
export function useReminderConfig(groupId: string): {
  reminderConfig: ReminderConfig | null;
  isLoadingConfig: boolean;
  upsertReminderConfig: (input: UpsertReminderConfigInput) => void;
  isUpsertingConfig: boolean;
}
```
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Add Smart Reminders UI to Group Detail Screen</name>
  <files>app/(app)/groups/[id]/index.tsx</files>
  <action>
Modify `app/(app)/groups/[id]/index.tsx` to include the smart reminder configuration UI:

1. Import dependencies:
```typescript
import { Switch } from 'react-native'
import { useReminderConfig } from '@/features/notifications/hooks'
```

2. Inside `GroupDetailScreen`, fetch the config:
```typescript
const { reminderConfig, upsertReminderConfig } = useReminderConfig(id)
const [showDelayPicker, setShowDelayPicker] = useState(false)
const reminderEnabled = reminderConfig?.enabled ?? true
const reminderDelay = reminderConfig?.delay_days ?? 3
```

3. Add a "Smart Reminders" section below the "Base Currency" section in the `ListHeaderComponent`:
```tsx
{/* NOTF-03: Smart Reminders Config */}
<View className="mt-4 mb-2">
  <Text className="text-white/50 text-sm uppercase tracking-wide mb-2">Smart Reminders</Text>
  <View className="bg-dark-surface border border-dark-border rounded-2xl px-4 py-3">
    <View className="flex-row items-center justify-between">
      <View>
        <Text className="text-white font-medium text-base">Automatic Nudges</Text>
        <Text className="text-white/40 text-xs mt-1">Remind members of unpaid debts</Text>
      </View>
      <Switch
        value={reminderEnabled}
        onValueChange={(val) => upsertReminderConfig({ group_id: id, enabled: val, delay_days: reminderDelay })}
        trackColor={{ false: '#333', true: '#6C63FF' }}
      />
    </View>
    {reminderEnabled && (
      <View className="mt-4 pt-4 border-t border-dark-border flex-row items-center justify-between">
        <Text className="text-white font-medium">Delay</Text>
        <TouchableOpacity onPress={() => setShowDelayPicker(true)} className="bg-dark-bg px-3 py-1.5 rounded-lg border border-dark-border">
          <Text className="text-brand-primary">{reminderDelay} days</Text>
        </TouchableOpacity>
      </View>
    )}
  </View>
</View>
```

4. Add a Modal for the delay days picker (similar to the currency picker modal) at the bottom of the component (e.g. together with currency modal):
```tsx
{/* NOTF-03: Reminder Delay picker modal */}
<Modal
  visible={showDelayPicker}
  animationType="slide"
  presentationStyle="pageSheet"
  onRequestClose={() => setShowDelayPicker(false)}
>
  <View className="flex-1 bg-dark-bg">
    <View className="px-4 pt-6 pb-3">
      <View className="flex-row items-center justify-between mb-4">
        <Text className="text-white font-bold text-xl">Reminder Delay</Text>
        <TouchableOpacity onPress={() => setShowDelayPicker(false)}>
          <Text className="text-brand-primary font-medium">Done</Text>
        </TouchableOpacity>
      </View>
    </View>
    <ScrollView>
      {[1, 2, 3, 5, 7, 14, 30].map(days => (
        <TouchableOpacity
          key={days}
          onPress={() => {
            upsertReminderConfig({ group_id: id, enabled: reminderEnabled, delay_days: days })
            setShowDelayPicker(false)
          }}
          className={`flex-row items-center px-4 py-4 border-b border-dark-border ${reminderDelay === days ? 'bg-brand-primary/10' : ''}`}
        >
          <Text className="text-white font-medium text-base flex-1">{days} {days === 1 ? 'day' : 'days'}</Text>
          {reminderDelay === days && <Text className="text-brand-primary text-sm font-medium">Selected</Text>}
        </TouchableOpacity>
      ))}
    </ScrollView>
  </View>
</Modal>
```
  </action>
  <verify>
    <automated>grep -q "useReminderConfig" app/\(app\)/groups/\[id\]/index.tsx && echo "PASS: hook imported" || echo "FAIL: hook not imported"</automated>
  </verify>
  <done>useReminderConfig mapped into GroupDetailScreen; 'Smart Reminders' section visible below 'Base Currency' section with Switch to toggle enabled and a modal to select delay_days.</done>
</task>

</tasks>

<verification>
Run `npx tsc --noEmit` â€” no type errors introduced in index.tsx.
Check `app/(app)/groups/[id]/index.tsx` contains `import { useReminderConfig } from '@/features/notifications/hooks'`.
Check `app/(app)/groups/[id]/index.tsx` contains `upsertReminderConfig({`.
</verification>

<success_criteria>
- app/(app)/groups/[id]/index.tsx updated to include smart reminders UI
- Toggle correctly mutates enabled via upsertReminderConfig
- Delay days can be selected and mutates delay_days via upsertReminderConfig
</success_criteria>

<output>
After completion, create `.planning/phases/03-engagement-layer/03-03-SUMMARY.md`
</output>
