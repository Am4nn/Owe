---
phase: 01-foundation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - app.json
  - eas.json
  - babel.config.js
  - metro.config.js
  - tailwind.config.js
  - global.css
  - nativewind-env.d.ts
  - tsconfig.json
  - .env.example
  - .gitignore
  - app/_layout.tsx
  - app/(auth)/_layout.tsx
  - app/(auth)/sign-in.tsx
  - app/(auth)/sign-up.tsx
  - app/(app)/_layout.tsx
  - app/(app)/index.tsx
  - src/lib/supabase.ts
  - src/lib/queryClient.ts
  - src/lib/persister.ts
  - src/stores/ui.ts
  - src/components/ui/Button.tsx
  - src/components/ui/Input.tsx
autonomous: true
requirements:
  - UIUX-01
  - OFFL-01

must_haves:
  truths:
    - "App opens in the EAS dev client (not Expo Go) with a dark background and neon accent colors visible"
    - "NativeWind className prop applies styles correctly — dark:bg-dark-bg and brand colors render"
    - "React Query cache is wired to MMKV persister — app shows stale data on cold launch while fetching fresh data"
    - "Tailwind is pinned to ^3.4.17 (not v4) — confirmed in package.json"
    - "Expo Router route groups (auth) and (app) exist with correct layouts"
    - "EAS dev client builds successfully for at least one platform (iOS simulator or Android)"
  artifacts:
    - path: "tailwind.config.js"
      provides: "NativeWind preset + neon color palette tokens"
      contains: "nativewind/preset"
    - path: "src/lib/persister.ts"
      provides: "MMKV-backed async persister for React Query"
      exports: ["persister"]
    - path: "src/lib/queryClient.ts"
      provides: "QueryClient with gcTime: 24h"
      exports: ["queryClient"]
    - path: "src/lib/supabase.ts"
      provides: "Supabase singleton client with expo-sqlite/localStorage auth adapter"
      exports: ["supabase"]
    - path: "app/_layout.tsx"
      provides: "Root layout with PersistQueryClientProvider"
      contains: "PersistQueryClientProvider"
    - path: "eas.json"
      provides: "EAS build profiles (development, preview, production)"
      contains: "developmentClient"
  key_links:
    - from: "app/_layout.tsx"
      to: "src/lib/persister.ts"
      via: "PersistQueryClientProvider persistOptions"
      pattern: "persistOptions.*persister"
    - from: "src/lib/supabase.ts"
      to: "expo-sqlite"
      via: "localStorage polyfill import"
      pattern: "expo-sqlite/localStorage"
    - from: "tailwind.config.js"
      to: "babel.config.js"
      via: "nativewind/babel preset"
      pattern: "nativewind/babel"
---

<objective>
Bootstrap the Expo SDK 55 project with a production-grade dev toolchain: EAS dev client (required for MMKV v4), NativeWind v4 dark mode with the project's neon fintech color palette, and the MMKV-backed React Query persister that powers offline-first cache reads (OFFL-01). This plan produces the project shell — every future plan imports from `src/lib/` and `src/features/` directories created here.

Purpose: Prevent Pitfalls 1, 2, and 7 from PITFALLS.md — Tailwind v4 breakage, MMKV-in-Expo-Go failure, and gcTime cache eviction — all of which are invisible bugs that corrupt the offline experience.

Output: A running Expo SDK 55 app in an EAS dev client with dark mode, route groups, and React Query offline persistence wired up. No user-facing feature screens yet — just the structural scaffold every other plan builds on.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bootstrap Expo SDK 55 project with all Phase 1 dependencies</name>
  <files>
    package.json
    app.json
    eas.json
    babel.config.js
    metro.config.js
    tailwind.config.js
    global.css
    nativewind-env.d.ts
    tsconfig.json
    .env.example
    .gitignore
  </files>
  <action>
Run the following commands in sequence from the project root. The project directory already exists (it is the git repo root), so skip the `create-expo-app` scaffold — instead install dependencies directly.

CRITICAL version pins (from research — violating these silently breaks the app):
- tailwindcss MUST be pinned to `^3.4.17` (NOT v4 — NativeWind 4.x is incompatible with Tailwind v4)
- react-native-reanimated MUST be pinned to 3.19.5 (NOT v4 — defer v4/worklets decision to Phase 2 when victory-native compatibility is evaluated)
- pnpm is the package manager — do NOT use npm or yarn

```bash
# 1. Initialize Expo SDK 55 project in current directory
pnpm dlx create-expo-app@latest . --template blank-typescript

# 2. EAS dev client — MUST be first native module installed
pnpm expo install expo-dev-client

# 3. Routing + navigation stack
pnpm expo install expo-router react-native-screens react-native-safe-area-context
pnpm expo install react-native-gesture-handler react-native-reanimated@3.19.5

# 4. State + data layer
pnpm add zustand @tanstack/react-query @tanstack/react-query-persist-client
pnpm add @tanstack/query-async-storage-persister
pnpm add react-native-mmkv react-native-nitro-modules
pnpm add zod react-hook-form @hookform/resolvers

# 5. Supabase + auth storage adapter
pnpm add @supabase/supabase-js
pnpm expo install expo-sqlite

# 6. NativeWind + Tailwind v3 (MUST use exact pin syntax)
pnpm add nativewind
pnpm add -D "tailwindcss@^3.4.17"

# 7. UI primitives for Phase 1
pnpm add lucide-react-native react-native-svg
pnpm expo install expo-image-picker expo-constants expo-updates expo-secure-store

# 8. Dev tools
pnpm add -D jest-expo @testing-library/react-native
pnpm add -D eslint eslint-config-expo prettier
pnpm add -D @types/react @types/react-native

# 9. EAS CLI (global)
pnpm add -g eas-cli
```

After installation, create/update these config files:

**eas.json** — minimal Phase 1 build profiles:
```json
{
  "cli": { "version": ">= 18.0.0" },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "android": { "withoutCredentials": true },
      "ios": { "simulator": true }
    },
    "preview": { "distribution": "internal" },
    "production": { "distribution": "store" }
  }
}
```

**tailwind.config.js** — NativeWind preset + neon fintech palette (UIUX-01):
```javascript
module.exports = {
  content: [
    "./app/**/*.{js,jsx,ts,tsx}",
    "./src/**/*.{js,jsx,ts,tsx}",
  ],
  presets: [require("nativewind/preset")],
  theme: {
    extend: {
      colors: {
        brand: {
          primary: "#6C63FF",   // Electric purple
          accent:  "#00F5D4",   // Neon teal
          danger:  "#FF4D6D",   // Debt red
          success: "#06D6A0",   // Settled green
        },
        dark: {
          bg:      "#0A0A0F",   // Deep background
          surface: "#131318",   // Card surface
          border:  "#1E1E2E",   // Subtle border
        },
      },
    },
  },
  plugins: [],
}
```

**babel.config.js** — NativeWind integration:
```javascript
module.exports = function (api) {
  api.cache(true);
  return {
    presets: [
      ["babel-preset-expo", { jsxImportSource: "nativewind" }],
      "nativewind/babel",
    ],
  };
};
```

**metro.config.js** — NativeWind metro wrapper:
```javascript
const { getDefaultConfig } = require("expo/metro-config");
const { withNativeWind } = require("nativewind/metro");
const config = getDefaultConfig(__dirname);
module.exports = withNativeWind(config, { input: "./global.css" });
```

**global.css** — Tailwind directives:
```css
@tailwind base;
@tailwind components;
@tailwind utilities;
```

**nativewind-env.d.ts** — TypeScript type declarations:
```typescript
/// <reference types="nativewind/types" />
```

**.env.example** — document required env vars (never put real values here):
```
EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
# SUPABASE_SERVICE_ROLE_KEY must NEVER appear in this file or app.config.js
# It belongs only in Supabase Vault and CI secrets
```

Update **app.json** to include:
- `"scheme": "nexus"` (required for deep links and expo-router)
- `"plugins": ["expo-router"]`
- `"experiments": { "typedRoutes": true }`
- `"newArchEnabled": true` (React Native New Architecture — on by default in RN 0.84, make explicit)

Update **.gitignore** to include:
```
.env
.env.local
.env*.local
```
(The .env.example is committed; actual .env files with keys are NOT)

Run `eas login` and `eas project:init` to link the project to EAS. Then trigger the first dev client build:
```bash
eas build --platform android --profile development
# or for iOS simulator:
eas build --platform ios --profile development --local
```
  </action>
  <verify>
    <automated>
      pnpm list react-native-mmkv nativewind tailwindcss react-native-reanimated | grep -E "(react-native-mmkv|nativewind|tailwindcss|reanimated)"
      # Expected: tailwindcss 3.x (NOT 4.x), react-native-reanimated 3.19.x
    </automated>
  </verify>
  <done>
    - package.json contains all required dependencies with correct version pins
    - tailwindcss is ^3.4.x (not v4)
    - react-native-reanimated is 3.19.5
    - eas.json has development, preview, and production build profiles
    - tailwind.config.js has nativewind/preset and full neon color palette
    - EAS dev client build has been triggered (build ID logged)
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire app structure — Expo Router groups, Supabase client, QueryClient, MMKV persister, dark mode</name>
  <files>
    app/_layout.tsx
    app/(auth)/_layout.tsx
    app/(auth)/sign-in.tsx
    app/(auth)/sign-up.tsx
    app/(app)/_layout.tsx
    app/(app)/index.tsx
    src/lib/supabase.ts
    src/lib/queryClient.ts
    src/lib/persister.ts
    src/stores/ui.ts
    src/components/ui/Button.tsx
    src/components/ui/Input.tsx
  </files>
  <action>
Create the directory structure and all files below. Screens are placeholders — they render correctly but have no interactive logic yet (that is Plan 01-03's job).

**src/lib/supabase.ts** — Supabase singleton with current official auth storage adapter:
```typescript
// IMPORTANT: This import must be at the top — it installs the localStorage polyfill
import 'expo-sqlite/localStorage/install'
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = process.env.EXPO_PUBLIC_SUPABASE_URL!
const supabaseAnonKey = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY!

// SECURITY: Only the anon key goes here. NEVER import or use SUPABASE_SERVICE_ROLE_KEY
// in any client-side file. Service role key lives in Supabase Vault + CI secrets only.
export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    storage: localStorage,      // expo-sqlite localStorage polyfill — no 2048-byte limit
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: false,  // Not a web app; URL-based OAuth not used
  },
})
```

**src/lib/queryClient.ts** — QueryClient with mandatory gcTime for persistence:
```typescript
import { QueryClient } from '@tanstack/react-query'

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // gcTime MUST be >= persister maxAge for OFFL-01 to work across sessions
      // Without this, cache is garbage-collected after 5 minutes (default), defeating persistence
      gcTime: 1000 * 60 * 60 * 24,   // 24 hours
      staleTime: 1000 * 30,           // Show stale, then refetch after 30s
      retry: 2,
    },
  },
})
```

**src/lib/persister.ts** — MMKV-backed async persister (bridges MMKV to React Query):
```typescript
import { MMKV } from 'react-native-mmkv'
import { createAsyncStoragePersister } from '@tanstack/query-async-storage-persister'

const storage = new MMKV()

// MMKV is synchronous natively; we wrap in Promise for the async persister interface
const mmkvStorage = {
  setItem: (key: string, value: string): Promise<void> => {
    storage.set(key, value)
    return Promise.resolve()
  },
  getItem: (key: string): Promise<string | null> => {
    const value = storage.getString(key)
    return Promise.resolve(value === undefined ? null : value)
  },
  removeItem: (key: string): Promise<void> => {
    storage.delete(key)
    return Promise.resolve()
  },
}

export const persister = createAsyncStoragePersister({ storage: mmkvStorage })
```

**src/stores/ui.ts** — Zustand store for UI state (NOT server state — that's React Query):
```typescript
import { create } from 'zustand'
import { colorScheme } from 'nativewind'

// Force dark mode on app launch (UIUX-01)
// This runs at module import time, before any component mounts
colorScheme.set('dark')

interface UIStore {
  isBottomSheetOpen: boolean
  activeGroupId: string | null
  setBottomSheetOpen: (open: boolean) => void
  setActiveGroupId: (id: string | null) => void
}

export const useUIStore = create<UIStore>((set) => ({
  isBottomSheetOpen: false,
  activeGroupId: null,
  setBottomSheetOpen: (open) => set({ isBottomSheetOpen: open }),
  setActiveGroupId: (id) => set({ activeGroupId: id }),
}))
```

**app/_layout.tsx** — Root layout with providers (session check delegated to (app)/_layout.tsx):
```tsx
import { Stack } from 'expo-router'
import { PersistQueryClientProvider } from '@tanstack/react-query-persist-client'
import { queryClient } from '@/lib/queryClient'
import { persister } from '@/lib/persister'
// Force dark mode store import (side-effect: sets colorScheme to 'dark')
import '@/stores/ui'

export default function RootLayout() {
  return (
    <PersistQueryClientProvider
      client={queryClient}
      persistOptions={{
        persister,
        maxAge: 1000 * 60 * 60 * 24, // 24 hours — matches gcTime
      }}
    >
      <Stack screenOptions={{ headerShown: false }} />
    </PersistQueryClientProvider>
  )
}
```

**app/(auth)/_layout.tsx** — Auth route group layout:
```tsx
import { Stack } from 'expo-router'

export default function AuthLayout() {
  return (
    <Stack
      screenOptions={{
        headerShown: false,
        contentStyle: { backgroundColor: '#0A0A0F' },
      }}
    />
  )
}
```

**app/(auth)/sign-in.tsx** — Placeholder sign-in screen (Plan 01-03 implements logic):
```tsx
import { View, Text } from 'react-native'

export default function SignInScreen() {
  return (
    <View className="flex-1 bg-dark-bg items-center justify-center">
      <Text className="text-white text-2xl font-bold">Sign In</Text>
      <Text className="text-white/50 mt-2">Auth implementation in Plan 01-03</Text>
    </View>
  )
}
```

**app/(auth)/sign-up.tsx** — Placeholder sign-up screen:
```tsx
import { View, Text } from 'react-native'

export default function SignUpScreen() {
  return (
    <View className="flex-1 bg-dark-bg items-center justify-center">
      <Text className="text-white text-2xl font-bold">Create Account</Text>
      <Text className="text-white/50 mt-2">Auth implementation in Plan 01-03</Text>
    </View>
  )
}
```

**app/(app)/_layout.tsx** — Protected route group layout placeholder (Stack.Protected guard added in Plan 01-03 when session hook exists):
```tsx
import { Stack } from 'expo-router'

export default function AppLayout() {
  return (
    <Stack
      screenOptions={{
        headerShown: false,
        contentStyle: { backgroundColor: '#0A0A0F' },
      }}
    />
  )
}
```

**app/(app)/index.tsx** — Dashboard placeholder:
```tsx
import { View, Text } from 'react-native'

export default function DashboardScreen() {
  return (
    <View className="flex-1 bg-dark-bg items-center justify-center">
      <Text className="text-brand-primary text-3xl font-bold">Owe</Text>
      <Text className="text-brand-accent mt-2 text-lg">Dashboard coming in Phase 2</Text>
    </View>
  )
}
```

**src/components/ui/Button.tsx** — Reusable button with NativeWind:
```tsx
import { TouchableOpacity, Text, TouchableOpacityProps } from 'react-native'

interface ButtonProps extends TouchableOpacityProps {
  title: string
  variant?: 'primary' | 'secondary' | 'danger'
}

export function Button({ title, variant = 'primary', className, ...props }: ButtonProps) {
  const variantClass = {
    primary: 'bg-brand-primary',
    secondary: 'bg-dark-surface border border-dark-border',
    danger: 'bg-brand-danger',
  }[variant]

  return (
    <TouchableOpacity
      className={`px-6 py-4 rounded-2xl items-center ${variantClass} ${className ?? ''}`}
      {...props}
    >
      <Text className="text-white font-semibold text-base">{title}</Text>
    </TouchableOpacity>
  )
}
```

**src/components/ui/Input.tsx** — Reusable text input with NativeWind:
```tsx
import { TextInput, TextInputProps, View, Text } from 'react-native'

interface InputProps extends TextInputProps {
  label?: string
  error?: string
}

export function Input({ label, error, className, ...props }: InputProps) {
  return (
    <View className="gap-1.5">
      {label && (
        <Text className="text-white/70 text-sm font-medium">{label}</Text>
      )}
      <TextInput
        className={`bg-dark-surface border border-dark-border rounded-xl px-4 py-3.5 text-white text-base ${error ? 'border-brand-danger' : ''} ${className ?? ''}`}
        placeholderTextColor="#ffffff40"
        {...props}
      />
      {error && (
        <Text className="text-brand-danger text-xs">{error}</Text>
      )}
    </View>
  )
}
```

After creating all files, ensure TypeScript path aliases are configured. In **tsconfig.json**, add or update:
```json
{
  "extends": "expo/tsconfig.base",
  "compilerOptions": {
    "strict": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```
  </action>
  <verify>
    <automated>
      # Verify file structure exists
      ls app/_layout.tsx app/(auth)/sign-in.tsx app/(app)/index.tsx src/lib/supabase.ts src/lib/persister.ts src/lib/queryClient.ts src/stores/ui.ts
      # Verify key patterns are present
      grep -l "PersistQueryClientProvider" app/_layout.tsx
      grep -l "gcTime" src/lib/queryClient.ts
      grep -l "expo-sqlite/localStorage" src/lib/supabase.ts
      grep -l "colorScheme.set" src/stores/ui.ts
    </automated>
  </verify>
  <done>
    - All files created with correct content
    - `src/lib/supabase.ts` imports expo-sqlite localStorage polyfill and uses it as auth storage
    - `src/lib/queryClient.ts` has gcTime of 24 hours (86400000 ms)
    - `src/lib/persister.ts` creates MMKV-backed async persister
    - `app/_layout.tsx` wraps the Stack in PersistQueryClientProvider
    - `src/stores/ui.ts` calls `colorScheme.set('dark')` on import
    - Dashboard screen renders with brand-primary (purple) and brand-accent (teal) colors visible
    - TypeScript path alias `@/*` maps to `src/*`
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Run `pnpm list tailwindcss` — output must show `3.x.x`, NOT `4.x.x`
2. Run `pnpm list react-native-reanimated` — output must show `3.19.x`
3. Run `pnpm list react-native-mmkv react-native-nitro-modules` — both must be present
4. Grep for service_role across all JS/TS files — must return 0 matches: `grep -r "service_role" app/ src/ --include="*.ts" --include="*.tsx"`
5. Verify EAS build was triggered and a build ID exists (either from `eas build:list` or the build URL logged during Task 1)
6. Verify `tailwind.config.js` contains all four brand color tokens and all three dark color tokens
7. Verify `app/_layout.tsx` contains `PersistQueryClientProvider` (not the basic `QueryClientProvider`)
</verification>

<success_criteria>
- App opens in the EAS dev client (not Expo Go) showing the dark (#0A0A0F) background dashboard screen with "Owe" in electric purple (#6C63FF)
- NativeWind className prop applies styles correctly (dark mode colors visible, not white background)
- tailwindcss is 3.x in node_modules (not 4.x)
- react-native-reanimated is 3.19.5 (not 4.x)
- React Query cache is persisted via MMKV — verifiable by checking MMKV storage has "tanstack-query" key after first load
- No SUPABASE_SERVICE_ROLE_KEY anywhere in tracked files
- EAS dev client build exists (any platform)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` with:
- What was built (file list)
- Key decisions made (auth storage adapter choice, reanimated v3 pin)
- EAS build ID/URL
- Any deviations from plan and why
</output>
