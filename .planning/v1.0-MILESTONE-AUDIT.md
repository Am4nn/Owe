---
milestone: v1.0
audited: 2026-03-01T02:00:00Z
status: gaps_found
scores:
  requirements: 35/42
  phases: 3/4
  integration: 38/42
  flows: 5/6
gaps:
  requirements:
    - id: "ACTY-01"
      status: "unsatisfied"
      phase: "Phase 2"
      claimed_by_plans: ["02-03-PLAN.md", "02-04-PLAN.md"]
      completed_by_plans: ["02-03-SUMMARY.md (comments/settlements only)", "02-04-SUMMARY.md (FK fix only)"]
      verification_status: "gaps_found"
      evidence: "createExpenseMutationFn, useUpdateExpense, useDeleteExpense in src/features/expenses/hooks.ts never insert into the activities table. DB schema CHECK constraint and TypeScript ActionType union define expense_added/expense_edited/expense_deleted, but no code path ever writes these rows. Activity feed silently shows only settlement and comment events."
    - id: "ACTY-02"
      status: "partial"
      phase: "Phase 2"
      claimed_by_plans: ["02-03-PLAN.md"]
      completed_by_plans: ["02-03-SUMMARY.md"]
      verification_status: "gaps_found"
      evidence: "Group filtering via .eq('group_id', groupId) works correctly. But expense-type activity rows are never created (ACTY-01 gap), so filtering expense events by group is also broken by inheritance."
    - id: "SETL-01"
      status: "partial"
      phase: "Phase 2"
      claimed_by_plans: ["02-03-PLAN.md"]
      completed_by_plans: ["02-03-SUMMARY.md"]
      verification_status: "passed"
      evidence: "Core settlement recording works. But useCreateSettlement inserts note: note ?? null (settlements/hooks.ts line 33), Settlement type declares note: string | null, and settlement form collects a note via TextInput — but the settlements table DDL in migration 20260227000001_foundation.sql has no note column. PostgREST silently ignores the unknown field. Note data is never persisted."
    - id: "SETL-03"
      status: "partial"
      phase: "Phase 2"
      claimed_by_plans: ["02-03-PLAN.md"]
      completed_by_plans: ["02-03-SUMMARY.md"]
      verification_status: "passed"
      evidence: "Settlement history listing renders correctly. But item.note is always null because the column does not exist in DB (inherited from SETL-01 gap)."
    - id: "NOTF-01"
      status: "partial"
      phase: "Phase 3"
      claimed_by_plans: ["03-01-PLAN.md"]
      completed_by_plans: ["03-01-SUMMARY.md"]
      verification_status: "passed"
      evidence: "Push notification delivery fully wired. But deep-link URL in push-notify/index.ts line 50 is /groups/${group_id}/expenses/${id}, which does not match Expo Router route /(app)/expenses/[id]. Tapping notification navigates to non-existent route. NOTF-02 settlement deep-link is correct."
    - id: "AUTH-06"
      status: "partial"
      phase: "Phase 1.5"
      claimed_by_plans: ["1.5-01-PLAN.md"]
      completed_by_plans: ["1.5-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Phase 1.5 is missing a VERIFICATION.md (unverified phase — blocker per workflow). Code evidence in SUMMARY.md is thorough; integration checker confirmed all wiring correct. Documentation gap only — no code gap."
    - id: "AUTH-07"
      status: "partial"
      phase: "Phase 1.5"
      claimed_by_plans: ["1.5-01-PLAN.md"]
      completed_by_plans: ["1.5-01-SUMMARY.md"]
      verification_status: "missing"
      evidence: "Same as AUTH-06 — Phase 1.5 VERIFICATION.md missing. AUTH-07 (email/Google account linking) handled server-side by Supabase. Integration checker confirmed no client code required beyond AUTH-06 wiring. Documentation gap only."
  integration:
    - id: "MISSING-01"
      from: "src/features/expenses/hooks.ts (createExpenseMutationFn, useUpdateExpense, useDeleteExpense)"
      to: "activities table"
      issue: "Expense CUD operations never write activity rows. expense_added/expense_edited/expense_deleted action types are dead letters."
      affects: ["ACTY-01", "ACTY-02"]
    - id: "MISSING-02"
      from: "src/features/settlements/hooks.ts (useCreateSettlement)"
      to: "settlements.note column"
      issue: "settlements table DDL has no note column. INSERT silently ignores the field. Silent data loss."
      affects: ["SETL-01", "SETL-03"]
    - id: "PARTIAL-01"
      from: "supabase/functions/push-notify/index.ts line 50"
      to: "app/(app)/expenses/[id]/index.tsx"
      issue: "Deep-link URL /groups/${group_id}/expenses/${id} does not match Expo Router route /(app)/expenses/[id]. Tap navigates to 404."
      affects: ["NOTF-01"]
tech_debt:
  - phase: 01.5-google-oauth-inserted
    items:
      - "Missing VERIFICATION.md — Phase 1.5 was not given a formal verification pass. Code correct per SUMMARY.md and integration checker. Requires 1.5-VERIFICATION.md to complete audit trail."
  - phase: 02-core-expense-loop
    items:
      - "REQUIREMENTS.md checkbox inconsistency: SETL-01, SETL-02, SETL-03, ACTY-04, OFFL-02, UIUX-02 still show [ ] Pending but are implemented and verified. Update to [x] (noting SETL-01/03 have note gap above)."
  - phase: 03-engagement-layer
    items:
      - "03-01-SUMMARY.md uses non-standard YAML structure (dependency_graph.provides vs requirements-completed). NOTF-01 and NOTF-02 not in frontmatter; breaks 3-source cross-reference."
  - phase: all
    items:
      - "Human verification pending across all phases: NativeWind rendering, session persistence, offline cache, activity feed FK fix on hosted DB, confetti/haptic, offline expense queue, Realtime sync, push delivery end-to-end, smart reminders, FX table population, multi-currency E2E, CSV export."
      - "ExpandableFAB.tsx ~line 38: Alert.alert('Coming soon') for Add Transfer button — intentional placeholder. Does not affect any v1 requirement."
---

# Milestone v1.0 Audit Report

**Milestone:** v1.0
**Audited:** 2026-03-01T02:00:00Z
**Status:** gaps_found — 3 code gaps + 1 unverified phase
**Requirements Score:** 35/42 satisfied | 6 partial | 1 unsatisfied

---

## Summary

All 4 phases executed (12/12 plans, 3 VERIFICATION.md files). Integration checker identified 3 code gaps. The FAIL gate is triggered by ACTY-01 (unsatisfied) — expense events are never written to the activity feed. Phase 1.5 has no VERIFICATION.md (documentation gap, not a code gap).

---

## Phase Verification Status

| Phase | Plans | VERIFICATION.md | Status | Score |
|-------|-------|-----------------|--------|-------|
| Phase 1: Foundation | 4/4 | ✓ 01-VERIFICATION.md | passed | 16/16 |
| Phase 1.5: Google OAuth | 1/1 | ✗ MISSING | unverified | — |
| Phase 2: Core Expense Loop | 4/4 | ✓ 02-VERIFICATION.md | human_needed | 19/19 |
| Phase 3: Engagement Layer | 3/3 | ✓ 03-VERIFICATION.md | human_needed | 10/10 |

---

## Requirements Coverage (3-Source Cross-Reference)

### Phase 1: Foundation — 12/12 satisfied

| Requirement | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Status |
|-------------|-------------|-------------|---------|--------------|--------|
| AUTH-01 | Email account creation | passed | ✓ (01-02) | [x] | satisfied |
| AUTH-02 | Email sign-in | passed | ✓ (01-02) | [x] | satisfied |
| AUTH-03 | Session persistence | passed | ✓ (01-02) | [x] | satisfied |
| AUTH-04 | Sign-out | passed | ✓ (01-02) | [x] | satisfied |
| AUTH-05 | Profile + avatar | passed | ✓ (01-02) | [x] | satisfied |
| GRUP-01 | Create group | passed | ✓ (01-02) | [x] | satisfied |
| GRUP-02 | Invite by email | passed | ✓ (01-02) | [x] | satisfied |
| GRUP-03 | Named-only members | passed | ✓ (01-02) | [x] | satisfied |
| GRUP-04 | View group list | passed | ✓ (01-02) | [x] | satisfied |
| GRUP-05 | Leave group | passed | ✓ (01-02) | [x] | satisfied |
| OFFL-01 | View cached data offline | passed | ✓ (01-01) | [x] | satisfied |
| UIUX-01 | Dark mode neon accent | passed | ✓ (01-01) | [x] | satisfied |

### Phase 1.5: Google OAuth — 0/2 formally verified (documentation gap)

| Requirement | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Status |
|-------------|-------------|-------------|---------|--------------|--------|
| AUTH-06 | Google OAuth sign-in/sign-up | MISSING | ✓ (1.5-01) | [x] | partial (verification gap) |
| AUTH-07 | Google OAuth email linking | MISSING | ✓ (1.5-01) | [x] | partial (verification gap) |

### Phase 2: Core Expense Loop — 18/22 satisfied, 3 partial, 1 unsatisfied

| Requirement | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Status |
|-------------|-------------|-------------|---------|--------------|--------|
| EXPN-01 | Add expense | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-02 | Equal split | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-03 | Exact split | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-04 | Percentage split | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-05 | Shares split | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-06 | Categories | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-07 | Edit expense | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-08 | Delete expense | passed | ✓ (02-01) | [x] | satisfied |
| EXPN-09 | 1-on-1 direct expense | passed | ✓ (02-01) | [x] | satisfied |
| BALS-01 | Dashboard balance summary | passed | ✓ (02-02) | [x] | satisfied |
| BALS-02 | Per-group member balances | passed | ✓ (02-02) | [x] | satisfied |
| BALS-03 | Simplified debt suggestions | passed | ✓ (02-02) | [x] | satisfied |
| SETL-01 | Record settlement | passed | ✓ (02-03) | [ ] ⚠ | **partial** — note field silently dropped (no DB column) |
| SETL-02 | Confetti + haptic | passed | ✓ (02-03) | [ ] ⚠ | satisfied (checkbox stale) |
| SETL-03 | Settlement history | passed | ✓ (02-03) | [ ] ⚠ | **partial** — note never stored/displayed |
| ACTY-01 | Activity feed — ALL expense events | gaps_found | ✓ (02-03) | [x] | **UNSATISFIED** — expense rows never written |
| ACTY-02 | Filter feed by group | gaps_found | ✓ (02-03) | [x] | **partial** — filtering works but expense events absent |
| ACTY-03 | Add comment | passed | ✓ (02-03) | [x] | satisfied |
| ACTY-04 | Emoji reaction | passed | ✓ (02-03) | [ ] ⚠ | satisfied (checkbox stale) |
| OFFL-02 | Offline expense queue | passed | ✓ (02-03) | [ ] ⚠ | satisfied (checkbox stale; human runtime needed) |
| UIUX-02 | Swipe expense card | passed | ✓ (02-03) | [ ] ⚠ | satisfied (checkbox stale) |
| UIUX-03 | FAB expands | passed | ✓ (02-01) | [x] | satisfied |

⚠ = REQUIREMENTS.md checkbox is `[ ]` but requirement is implemented and verified (6 stale checkboxes total)

### Phase 3: Engagement Layer — 6/8 satisfied, 2 partial

| Requirement | Description | VERIFICATION | SUMMARY | REQUIREMENTS | Status |
|-------------|-------------|-------------|---------|--------------|--------|
| NOTF-01 | Push notification on expense | passed | ✗ (not in frontmatter) | [x] | **partial** — fires correctly; tap deep-link navigates to 404 |
| NOTF-02 | Push notification on settlement | passed | ✗ (not in frontmatter) | [x] | satisfied |
| NOTF-03 | Smart reminders | passed | ✓ (03-03) | [x] | satisfied |
| CURR-01 | Group base currency | passed | ✓ (03-02) | [x] | satisfied |
| CURR-02 | Expense in different currency | passed | ✓ (03-02) | [x] | satisfied |
| CURR-03 | FX rate at creation | passed | ✓ (03-02) | [x] | satisfied |
| CURR-04 | Dual-amount display | passed | ✓ (03-02) | [x] | satisfied |
| EXPT-01 | CSV export | passed | ✓ (03-02) | [x] | satisfied |

---

## Unsatisfied Requirements (FAIL Gate Triggered)

### ACTY-01 — Activity feed missing expense events [CRITICAL BLOCKER]

**Phase:** 2 | **Plans claiming this:** 02-03, 02-04

`createExpenseMutationFn`, `useUpdateExpense`, and `useDeleteExpense` in `src/features/expenses/hooks.ts` never insert rows into the `activities` table. The `expense_added`, `expense_edited`, and `expense_deleted` action types exist in the DB CHECK constraint and TypeScript union, but no code path produces them. The activity feed shows only settlement and comment events.

The fix pattern already exists in `src/features/settlements/hooks.ts` (lines 45–63): resolve the current user's `group_members.id` for the group, then insert an `activities` row with the resolved `actor_id`. Each expense mutation function needs this pattern applied.

---

## Code Gaps (Integration Checker Findings)

### Gap 1 — Expense CUD never writes activity rows (ACTY-01, ACTY-02) [High]

`src/features/expenses/hooks.ts` — all three mutation functions missing `activities` INSERT.
Fix: Apply the same actor-resolution + activities INSERT pattern from `settlements/hooks.ts` lines 45–63 to `createExpenseMutationFn`, `useUpdateExpense`, and `useDeleteExpense`.

### Gap 2 — `settlements.note` column absent from DB migration (SETL-01, SETL-03) [Medium]

`supabase/migrations/20260227000001_foundation.sql` settlements table DDL (lines 306–318) — no `note` column.
Fix: New migration `ALTER TABLE public.settlements ADD COLUMN note TEXT;`

### Gap 3 — Push notification deep-link URL format mismatch (NOTF-01) [Low]

`supabase/functions/push-notify/index.ts` line 50: `dataUrl = \`/groups/\${record.group_id}/expenses/\${record.id}\``
Should be: `dataUrl = \`/expenses/\${record.id}\`` (matches Expo Router route `/(app)/expenses/[id]`)

---

## Integration Verification

| Integration Path | Status |
|-----------------|--------|
| Phase 1 auth hooks → Phase 2+ screens | WIRED |
| Phase 1.5 OAuth → Phase 1 auth patterns (same onAuthStateChange path) | WIRED |
| Phase 2 createExpenseMutationFn → Phase 3 FX fields (additive, backward-compatible) | WIRED |
| Phase 3 push chain → Phase 2 data shapes (expenses/settlements columns correct) | WIRED |
| DB schema integrity across 5 migrations | WIRED |
| Phase 2 screens → Phase 3 additions to shared files (no regressions) | WIRED |
| Expense CUD → activities table | **MISSING** (ACTY-01) |
| useCreateSettlement → settlements.note column | **MISSING** (SETL-01) |
| push-notify expense deep-link → Expo Router route | **PARTIAL** (NOTF-01) |

---

## E2E Flow Verification

| Flow | Status | Breaks At |
|------|--------|-----------|
| Sign up → create group → invite member | Complete | — |
| Sign in with Google OAuth | Complete | — |
| Add expense → view balances → settle debt → confetti | Complete | — |
| Add expense → view activity feed | **Broken** | No expense event appears in feed |
| Set base currency → add multi-currency expense → view dual amounts | Complete | — |
| Export group CSV | Complete | — |

---

## Tech Debt

**Phase 1.5** — Missing `1.5-VERIFICATION.md` (code correct; audit trail gap)

**Phase 2** — 6 stale REQUIREMENTS.md checkboxes: SETL-01, SETL-02, SETL-03, ACTY-04, OFFL-02, UIUX-02 (all `[ ]` but implemented)

**Phase 3** — `03-01-SUMMARY.md` missing `requirements-completed` frontmatter for NOTF-01 and NOTF-02

**All phases** — ~12 items pending human/device runtime verification (push delivery, confetti, offline queue, Realtime, FX table, etc.)

**All phases** — `ExpandableFAB.tsx` "Add Transfer" placeholder — intentional, does not affect v1 requirements

---

## Orphan Detection

No orphaned requirements. All 42 REQ-IDs in the REQUIREMENTS.md traceability table appear in at least one SUMMARY.md or VERIFICATION.md. Zero unverified assignments.

---

_Audited: 2026-03-01T02:00:00Z_
_Auditor: Claude (gsd-orchestrator) + gsd-integration-checker (sonnet, 84 tool uses, 260s)_
